<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competitive Programming Editor</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
<style>
  body { background-color: #1e1e1e; color: white; transition: background 0.3s, color 0.3s; }
  #editor { height: 400px; border: 1px solid #444; }
  .light { background-color: #f9f9f9; color: black; }
  .light textarea, .light pre { background-color: #fff; color: black; border-color: #ccc; }
  .resizable { resize: horizontal; overflow: auto; min-width: 200px; }
  .panel-title {
    text-align: center;
    font-size: 1.25rem;
    font-weight: bold;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
    border-bottom: 2px solid rgba(255,255,255,0.2);
    background: linear-gradient(to right, #60a5fa, #a78bfa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .light .panel-title {
    background: linear-gradient(to right, #2563eb, #9333ea);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
</style>
</head>
<body class="p-4">

<div class="flex justify-between items-center mb-4">
  <h1 class="text-2xl font-bold">CP Editor</h1>
  <button id="themeToggle" class="px-4 py-2 bg-gray-700 rounded">Toggle Dark/Light</button>
</div>

<div class="flex gap-4">
  <!-- Problem statement -->
  <div class="w-1/3 resizable">
    <h2 class="panel-title">Problem Statement</h2>
    <textarea id="problem" class="w-full h-[400px] p-2 bg-gray-800 border border-gray-700 rounded" placeholder="Paste your problem statement here..."></textarea>
  </div>

  <!-- Editor + Test case -->
  <div class="w-1/3 resizable">
    <h2 class="panel-title">Code Editor</h2>
    <div id="editor"></div>
    <textarea id="input" class="w-full mt-2 p-2 bg-gray-800 border border-gray-700 rounded" placeholder="Custom test cases..."></textarea>
    <div class="flex gap-2 mt-2">
      <button id="runBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded">Run Code</button>
      <button id="saveBtn" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded">Save Solution</button>
    </div>
    <pre id="output" class="mt-2 p-2 bg-black border border-gray-700 rounded" style="height: 200px; overflow-y: auto;"></pre>
  </div>

  <!-- Saved solutions -->
  <div class="w-1/3 resizable">
    <h2 class="panel-title">Saved Solutions</h2>
    <ul id="solutionList" class="space-y-2"></ul>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>
<script>
  // Theme Toggle
  document.getElementById("themeToggle").addEventListener("click", () => {
    document.body.classList.toggle("light");
  });

  // Monaco Editor
  require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs' }});
  require(["vs/editor/editor.main"], function () {
    window.editor = monaco.editor.create(document.getElementById('editor'), {
      value: `#include <bits/stdc++.h>
using namespace std;
int main() {
    cout << "Hello World";
    return 0;
}`,
      language: "cpp",
      theme: "vs-dark",
      automaticLayout: true
    });
  });

  // Run Code
  document.getElementById('runBtn').addEventListener('click', async () => {
    const source_code = window.editor.getValue();
    const stdin = document.getElementById('input').value;
    const response = await fetch("https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=false&wait=true", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-rapidapi-host": "judge0-ce.p.rapidapi.com",
        "x-rapidapi-key": "f5deb01607msh6c40db8f424e01dp14bc48jsnb21a6af4366c"
      },
      body: JSON.stringify({
        source_code,
        language_id: 54, // C++ (GCC 9.2.0)
        stdin
      })
    });
    const result = await response.json();
    document.getElementById('output').textContent = result.stdout || result.stderr || result.compile_output || "No output";
  });

  // Save Solution
  document.getElementById('saveBtn').addEventListener('click', () => {
    const problem = document.getElementById('problem').value.trim();
    const code = window.editor.getValue().trim();
    if (!problem || !code) return alert("Problem and Code are required!");

    const solutions = JSON.parse(localStorage.getItem('solutions') || "[]");
    solutions.push({ problem, code, date: new Date().toLocaleString() });
    localStorage.setItem('solutions', JSON.stringify(solutions));
    loadSolutions();
  });

  // Load Saved Solutions
  function loadSolutions() {
    const list = document.getElementById('solutionList');
    list.innerHTML = "";
    const solutions = JSON.parse(localStorage.getItem('solutions') || "[]");
    solutions.forEach((s, i) => {
      const li = document.createElement("li");
      li.className = "bg-gray-800 p-2 rounded border border-gray-700 flex flex-col gap-2";
      li.innerHTML = `<strong>${s.date}</strong><br>${s.problem.substring(0, 40)}...`;

      // Button container
      const btnContainer = document.createElement("div");
      btnContainer.className = "flex gap-2 mt-2";

      // Edit button
      const editBtn = document.createElement("button");
      editBtn.textContent = "Edit";
      editBtn.className = "px-2 py-1 bg-yellow-600 hover:bg-yellow-500 rounded text-sm";
      editBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        document.getElementById('problem').value = s.problem;
        window.editor.setValue(s.code);
      });

      // Delete button
      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.className = "px-2 py-1 bg-red-600 hover:bg-red-500 rounded text-sm";
      deleteBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        if (confirm("Are you sure you want to delete this solution?")) {
          solutions.splice(i, 1);
          localStorage.setItem('solutions', JSON.stringify(solutions));
          loadSolutions();
        }
      });

      btnContainer.appendChild(editBtn);
      btnContainer.appendChild(deleteBtn);
      li.appendChild(btnContainer);

      li.addEventListener("click", () => {
        document.getElementById('problem').value = s.problem;
        window.editor.setValue(s.code);
      });
      list.appendChild(li);
    });
  }

  loadSolutions();
</script>

<footer class="w-full mt-8 py-4 bg-gray-900 text-center text-gray-300 text-lg font-semibold" style="letter-spacing:1px;">
  Developer: Md Sobuj Mia
</footer>
</script>
</body>
</html>
